{% extends 'base.html'%}
{% load static%} 
{% block content %}

<div class="col-md-8 pt-3 m-auto">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">{{post_object.title}}</h5>
        <h6 class="card-subtitle mb-2 text-muted">Posted By: {{post_object.author_name}}</h6>
        <p class="card-text">{{post_object.content}}</p>
        <p>Posted Date: {{post_object.publish_date}}</p>
        <div class="row">
        <form action="{% url 'posts' %}">
          <input class="btn btn-success mr-2" type="submit" value="Go Back" />
      </form>
      {% if request.user.is_superuser or request.user == post_object.author_name %}
      <form action="{% url 'postUpdate' post_object.id %}">
        <input class="btn btn" type="submit" value="Update" />
    </form>
      {% endif %}

</div>
      </div>
    </div>
    <hr/>
  <h2>Comments.....</h2>
  <div class="form-outline mb-4">
      <div id="no_input"></div>
    <input
      type="text"
      id="addComment"
      class="form-control"
      placeholder="Type comment..."
    />
    <button class="form-label btn mt-1" for="addANote" id="save_comment">Add Comment</button>
  </div>
  {% if not comments_list %}
    No Comments To Show
  {% else %}
  {% for comment in comments_list %}
  <div class="card mb-1">
    <div class="card-body">
      <p>{{ comment.comment}}</p>
      <div class="d-flex justify-content-between">
        <div class="d-flex flex-row align-items-center">
          <p class="small mb-0 ms-2">{{comment.name}}</p>
          <small>{{comment.created_on}}</small>
        </div>
        <div class="d-flex flex-row align-items-center">
        </div>
      </div>
    </div>
  </div>
    {% endfor %}
    {%endif%}
</div>
<script>
    $("#save_comment").on('click',function(){
        comment = $("#addComment").val()
        console.log("---------------------",window.location.href)
        if(comment.length !=0){
            $("#no_input").empty()
            $.ajax({
                url: "",
                method: 'POST',
                data: {
                    comment: comment,
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
                headers: {'X-CSRFToken': $("input[name=csrfmiddlewaretoken]").val()},
                success: function (data) {
                  console.log(data.Message)
                }
            });
        }
        else{
            $("#no_input").append("<p>*Cant post an empty comment </p>")
        }
    })
</script>


{% endblock %}